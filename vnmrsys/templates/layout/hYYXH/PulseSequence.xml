<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--
  hYYXH PulseSequence Tab
  4D sequence: H → HY CP → [Y evolution d4 F4] → [Y-Y mixing] → [Y evolution d3 F3] → YX CP → [X evolution d2 F2] → XH CP → [optional HH-RFDR] → H(direct)
-->
<template name="PulseSequence" element="pages" type="acquisition" >
  <group size="750 640"
    style="Heading1"
    label="Pulse Sequence"
    vq="panellevel"
    show="$SHOW=(panellevel&gt;0)"
    border="None"
    side="Top"
    justify="Left"
    tab="yes"
    enable="no"
    reference="PulseSequence"
    useref="no"
    subtype="Basic"
    expanded="yes"
    >

    <!-- Sequence Control -->
    <group loc="10 10" size="350 150"
      style="Heading2"
      label="Sequence Control"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Basic"
      >
      <check loc="10 20" size="200 20"
        label="Soft Pulse F4 (d4 Y evolution)"
        vq="softpul"
        vc="softpul='y'"
        vc2="softpul='n'"
        set="if softpul='y' then $VALUE=1 else $VALUE=0 endif"
        tooltip="Enable soft pulse excitation for F4 Y evolution"
        />

      <check loc="10 50" size="200 20"
        label="Soft Pulse F3 (d3 Y evolution)"
        vq="softpul2"
        vc="softpul2='y'"
        vc2="softpul2='n'"
        set="if softpul2='y' then $VALUE=1 else $VALUE=0 endif"
        tooltip="Enable soft pulse excitation for F3 Y evolution"
        />

      <check loc="10 80" size="200 20"
        label="H-H RFDR Mixing (qHrfdr)"
        vq="qHrfdr"
        vc="qHrfdr='y'"
        vc2="qHrfdr='n'"
        set="if qHrfdr='y' then $VALUE=1 else $VALUE=0 endif"
        tooltip="Enable optional H-H RFDR mixing after XH CP"
        />

      <label loc="10 110" size="80 20"
        style="Label1"
        label="tRF"
        justify="Left"
        />
      <entry loc="100 110" size="80 20"
        style="PlainText"
        vq="tRF"
        vc="tRF=$VALUE"
        set="$VALUE=tRF"
        digits="3"
        tooltip="Total RF time for NUS safety check"
        />
      <label loc="190 110" size="30 20"
        style="Label1"
        label="ms"
        />
    </group>

    <!-- Cross-Polarization HY -->
    <group loc="370 10" size="370 150"
      style="Heading2"
      label="Cross-Polarization (H → Y)"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Basic"
      >
      <label loc="10 20" size="100 20"
        style="Label1"
        label="Contact Time"
        justify="Left"
        />
      <entry loc="120 20" size="80 20"
        style="PlainText"
        vq="tHY"
        vc="tHY=$VALUE*1000"
        set="$VALUE=tHY/1000"
        digits="2"
        />
      <label loc="210 20" size="30 20"
        style="Label1"
        label="ms"
        />

      <label loc="10 50" size="100 20"
        style="Label1"
        label="H Amplitude"
        justify="Left"
        />
      <entry loc="120 50" size="80 20"
        style="PlainText"
        vq="aHhy"
        vc="aHhy=$VALUE"
        set="$VALUE=aHhy"
        digits="0"
        />

      <label loc="10 80" size="100 20"
        style="Label1"
        label="Y Amplitude"
        justify="Left"
        />
      <entry loc="120 80" size="80 20"
        style="PlainText"
        vq="aYhy"
        vc="aYhy=$VALUE"
        set="$VALUE=aYhy"
        digits="0"
        />

      <label loc="10 110" size="100 20"
        style="Label1"
        label="Ramp Profile"
        justify="Left"
        />
      <entry loc="120 110" size="80 20"
        style="PlainText"
        vq="shHY"
        vc="shHY='$VALUE'"
        set="$VALUE=shHY"
        tooltip="Ramp shape for H→Y CP"
        />
    </group>

    <!-- Y-Y Mixing -->
    <group loc="10 170" size="730 210"
      style="Heading2"
      label="Y-Y Mixing"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Basic"
      >
      <label loc="10 20" size="100 20"
        style="Heading3"
        label="Mixing Method"
        justify="Left"
        />
      <menu loc="120 20" size="120 20"
        style="PlainText"
        vq="mMix"
        vc="parunits('set','mMix','$VALUE')"
        set="$VALUE=mMix"
        editable="No"
        tooltip="Y-Y mixing sequence type"
        >
        <mlabel label="none" chval="n" />
        <mlabel label="SPCN" chval="spcn" />
        <mlabel label="SPC5" chval="spc5" />
        <mlabel label="RFDR" chval="rfdr" />
      </menu>

      <label loc="10 50" size="100 20"
        style="Label1"
        label="Mixing Time"
        justify="Left"
        />
      <entry loc="120 50" size="80 20"
        style="PlainText"
        vq="tYmix"
        vc="tYmix=$VALUE"
        set="$VALUE=tYmix"
        digits="3"
        tooltip="Y-Y mixing period (rounded to rotor cycles)"
        />
      <label loc="210 50" size="30 20"
        style="Label1"
        label="ms"
        />

      <label loc="10 80" size="100 20"
        style="Label1"
        label="Zero-Field Delay"
        justify="Left"
        />
      <entry loc="120 80" size="80 20"
        style="PlainText"
        vq="tZF_Y"
        vc="tZF_Y=$VALUE"
        set="$VALUE=tZF_Y"
        digits="3"
        tooltip="Used in SPCN and SPC5"
        />
      <label loc="210 80" size="30 20"
        style="Label1"
        label="µs"
        />

      <!-- Y Mixing Amplitudes Column 1 -->
      <label loc="280 20" size="200 20"
        style="Heading3"
        label="Y Mixing Amplitudes"
        />

      <label loc="280 45" size="100 20"
        style="Label1"
        label="SPCN (aYspcn)"
        justify="Left"
        />
      <entry loc="390 45" size="60 20"
        style="PlainText"
        vq="aYspcn"
        vc="aYspcn=$VALUE"
        set="$VALUE=aYspcn"
        digits="0"
        />

      <label loc="280 70" size="100 20"
        style="Label1"
        label="SPC5 (aYspc5)"
        justify="Left"
        />
      <entry loc="390 70" size="60 20"
        style="PlainText"
        vq="aYspc5"
        vc="aYspc5=$VALUE"
        set="$VALUE=aYspc5"
        digits="0"
        />

      <label loc="280 95" size="100 20"
        style="Label1"
        label="RFDR (aYrfdr)"
        justify="Left"
        />
      <entry loc="390 95" size="60 20"
        style="PlainText"
        vq="aYrfdr"
        vc="aYrfdr=$VALUE"
        set="$VALUE=aYrfdr"
        digits="0"
        />

      <!-- Y Mixing Rotor Periods -->
      <label loc="470 45" size="100 20"
        style="Label1"
        label="SPCN Periods (NYspcn)"
        justify="Left"
        />
      <entry loc="590 45" size="60 20"
        style="PlainText"
        vq="NYspcn"
        vc="NYspcn=$VALUE"
        set="$VALUE=NYspcn"
        digits="0"
        tooltip="Number of rotor periods for SPCN"
        />

      <label loc="470 70" size="100 20"
        style="Label1"
        label="SPC5 Periods (NYspc5)"
        justify="Left"
        />
      <entry loc="590 70" size="60 20"
        style="PlainText"
        vq="NYspc5"
        vc="NYspc5=$VALUE"
        set="$VALUE=NYspc5"
        digits="0"
        tooltip="Number of rotor periods for SPC5"
        />

      <label loc="470 95" size="100 20"
        style="Label1"
        label="RFDR xy8 (qYrfdr)"
        justify="Left"
        />
      <entry loc="590 95" size="60 20"
        style="PlainText"
        vq="qYrfdr"
        vc="qYrfdr=$VALUE"
        set="$VALUE=qYrfdr"
        digits="0"
        tooltip="Number of xy8 cycles for RFDR"
        />

      <!-- SPCN/SPC5 Additional Parameters -->
      <label loc="10 120" size="100 20"
        style="Label1"
        label="SPCN qYspcn"
        justify="Left"
        />
      <entry loc="120 120" size="80 20"
        style="PlainText"
        vq="qYspcn"
        vc="qYspcn=$VALUE"
        set="$VALUE=qYspcn"
        digits="0"
        tooltip="Number of SPCN cycles"
        />

      <label loc="10 150" size="100 20"
        style="Label1"
        label="SPC5 qYspc5"
        justify="Left"
        />
      <entry loc="120 150" size="80 20"
        style="PlainText"
        vq="qYspc5"
        vc="qYspc5=$VALUE"
        set="$VALUE=qYspc5"
        digits="0"
        tooltip="Number of SPC5 cycles"
        />

      <label loc="10 180" size="100 20"
        style="Label1"
        label="RFDR pwYrfdr"
        justify="Left"
        />
      <entry loc="120 180" size="80 20"
        style="PlainText"
        vq="pwYrfdr"
        vc="pwYrfdr=$VALUE"
        set="$VALUE=pwYrfdr"
        digits="2"
        tooltip="RFDR pulse width"
        />
      <label loc="210 180" size="30 20"
        style="Label1"
        label="µs"
        />
    </group>

    <!-- Cross-Polarization YX -->
    <group loc="10 390" size="360 150"
      style="Heading2"
      label="Cross-Polarization (Y → X)"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Basic"
      >
      <label loc="10 20" size="100 20"
        style="Label1"
        label="Contact Time"
        justify="Left"
        />
      <entry loc="120 20" size="80 20"
        style="PlainText"
        vq="tYX"
        vc="tYX=$VALUE*1000"
        set="$VALUE=tYX/1000"
        digits="2"
        />
      <label loc="210 20" size="30 20"
        style="Label1"
        label="ms"
        />

      <label loc="10 50" size="100 20"
        style="Label1"
        label="Y Amplitude"
        justify="Left"
        />
      <entry loc="120 50" size="80 20"
        style="PlainText"
        vq="aYyx"
        vc="aYyx=$VALUE"
        set="$VALUE=aYyx"
        digits="0"
        />

      <label loc="10 80" size="100 20"
        style="Label1"
        label="X Amplitude"
        justify="Left"
        />
      <entry loc="120 80" size="80 20"
        style="PlainText"
        vq="aXyx"
        vc="aXyx=$VALUE"
        set="$VALUE=aXyx"
        digits="0"
        />

      <label loc="10 110" size="100 20"
        style="Label1"
        label="Ramp Profile"
        justify="Left"
        />
      <entry loc="120 110" size="80 20"
        style="PlainText"
        vq="shYX"
        vc="shYX='$VALUE'"
        set="$VALUE=shYX"
        tooltip="Ramp shape for Y→X CP"
        />
    </group>

    <!-- Cross-Polarization XH -->
    <group loc="380 390" size="360 150"
      style="Heading2"
      label="Cross-Polarization (X → H)"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Basic"
      >
      <label loc="10 20" size="100 20"
        style="Label1"
        label="Contact Time"
        justify="Left"
        />
      <entry loc="120 20" size="80 20"
        style="PlainText"
        vq="tXH"
        vc="tXH=$VALUE*1000"
        set="$VALUE=tXH/1000"
        digits="2"
        />
      <label loc="210 20" size="30 20"
        style="Label1"
        label="ms"
        />

      <label loc="10 50" size="100 20"
        style="Label1"
        label="X Amplitude"
        justify="Left"
        />
      <entry loc="120 50" size="80 20"
        style="PlainText"
        vq="aXxh"
        vc="aXxh=$VALUE"
        set="$VALUE=aXxh"
        digits="0"
        />

      <label loc="10 80" size="100 20"
        style="Label1"
        label="H Amplitude"
        justify="Left"
        />
      <entry loc="120 80" size="80 20"
        style="PlainText"
        vq="aHxh"
        vc="aHxh=$VALUE"
        set="$VALUE=aHxh"
        digits="0"
        />

      <label loc="10 110" size="100 20"
        style="Label1"
        label="Ramp Profile"
        justify="Left"
        />
      <entry loc="120 110" size="80 20"
        style="PlainText"
        vq="shXH"
        vc="shXH='$VALUE'"
        set="$VALUE=shXH"
        tooltip="Ramp shape for X→H CP"
        />
    </group>

    <!-- H-H RFDR Mixing (Optional) -->
    <group loc="10 550" size="360 80"
      style="Heading2"
      label="H-H RFDR Mixing (Optional)"
      vq="qHrfdr"
      show="if qHrfdr='y' then $SHOW=1 else $SHOW=0 endif"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Basic"
      >
      <label loc="10 20" size="100 20"
        style="Label1"
        label="Mixing Time"
        justify="Left"
        />
      <entry loc="120 20" size="80 20"
        style="PlainText"
        vq="tHmix"
        vc="tHmix=$VALUE"
        set="$VALUE=tHmix"
        digits="3"
        tooltip="H-H RFDR mixing period"
        />
      <label loc="210 20" size="30 20"
        style="Label1"
        label="ms"
        />

      <label loc="10 50" size="100 20"
        style="Label1"
        label="RFDR Amplitude"
        justify="Left"
        />
      <entry loc="120 50" size="80 20"
        style="PlainText"
        vq="aHrfdr"
        vc="aHrfdr=$VALUE"
        set="$VALUE=aHrfdr"
        digits="0"
        />
    </group>

  </group>
</template>
